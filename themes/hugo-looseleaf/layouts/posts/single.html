
{{ define "main" }}
<!--<div class="post-meta" style="margin: auto;">-->

    {{ partial "nav.html" .}}
<!--</div>-->
<article {{ if .Params.hidden }}data-pagefind-ignore{{ end }}>
    <h1 data-pagefind-meta="title" {{ if .Params.hidden }}data-pagefind-ignore{{ end }}t>{{ .Title }}</h1>
    <div id="post-meta">
        <time datetime="{{ .Date }}">
            {{ .Date | time.Format site.Params.theme_config.date_format }}
            <span> ‧ {{ .WordCount }}</span>
            <span>words</span>
            ‧ <span> </span>
            {{ if .Params.tags }}
                    {{ range .Params.tags }}
                    <a href="{{ "/tags/" | relURL }}{{ . | urlize }}">＃{{ . }}</a>
                    {{ end }}
            {{ end }}
        </time>
        {{ if .Description }}
        <div id="post-description">
            {{ .Description }}
        </div>
        {{ end }}
    </div>

    {{ if .Params.toc | default true }}
    {{ partial "toc.html" . }}
    {{ end }}

<div id="post-content"  data-pagefind-body>
    {{ $emojiPattern := `:([A-Za-z0-9_-]+):` }}
    {{ $tableWrapper := printf "<div class=\"table-wrapper\">${1}</div>" }}
    {{ .Content     
        | replaceRE $emojiPattern `<img class="emojis" src="/img/emoji/$1.png" alt=":$1:" loading="lazy">`     
        | replaceRE "(<table>(?:.|\n)+?</table>)" $tableWrapper     
        | safeHTML 
    }}
    {{ if .Params.search }}
    {{ partial "pagefind.html" . }}
    {{ end }}
</div>
    <br>
    <div style="padding-bottom:3px;"></div>
</article>

<nav class="custom-paginav">
    {{ with .PrevInSection }}
    <a class="custom-paginav-prev" href="{{ .RelPermalink }}">
        <span class="custom-paginav-title">« Prev</span><br>
        <span>{{ .Title }}</span>
    </a>
    {{ end }}
    {{ with .NextInSection }}
    <a class="custom-paginav-next" href="{{ .RelPermalink }}">
        <span class="custom-paginav-title">Next »</span><br>
        <span>{{ .Title }}</span>
    </a>
    {{ end }}
</nav>

{{ if .Params.comment | default true }}
<!--<br>-->
<script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css" />
<!--<img src="/site/ghostszombies.gif" class="divider" style="display: block; margin-left: auto; margin-right: auto;" data-pagefind-ignore />-->
<div id="comments" class="comments" data-pagefind-ignore>
    {{ partial "comment.html" . }}
</div>
{{ end }}

    <div>

    {{- partial "footer.html" . -}}

    </div>

<!--{{ $scriptViewImage := resources.Get "js/view-image.min.js" }}-->
<!--{{ if $scriptViewImage }}-->
<!--{{ $scriptViewImage = $scriptViewImage | js.Build | resources.Fingerprint }}-->
<!--<script src="{{ $scriptViewImage.RelPermalink }}" integrity="{{ $scriptViewImage.Data.Integrity }}" crossorigin="anonymous"></script>-->
<!--{{ else }}-->
<!--{{ end }}-->
<!--<script>-->
<!--    document.addEventListener('DOMContentLoaded', () => {-->
<!--        if (window.ViewImage) {-->
<!--            ViewImage.init('img:not([no-view]):not(.emoji):not(#emoji)');-->
<!--        } else {-->
<!--            console.warn("ViewImage object not found. Is view-image.min.js loaded correctly?");-->
<!--        }-->
<!--    });-->
<!--</script>-->
{{ end }}
